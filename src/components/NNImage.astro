---
////////////////////////////////////////////////////////////////////////////////
// NNImage.astro ///////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
// Noonoo image component.
// Can be customized to display a slideshow, run looping animated images/videos,
// have rounded or straight corners, and be displayed as a protrusion,
// depression, card, or flat.

import { Image } from '@astrojs/image/components';

export interface Props {
  src: string
  alt: string
  caption?: string
  animated?: boolean,
  straightCorners?: boolean,
  linked?: boolean,
  display?: string
}

const { 
  src,
  alt,
  caption,
  animated = false,
  straightCorners = false,
  linked = true,
  display = "depressed"
} = Astro.props as Props;

// Determine how image is displayed:
let imgClasses = "container";
// Corners:
if (straightCorners) {
  imgClasses += " straight-corners";
} else {
  imgClasses += " round-corners";
}
// Neumorphic object:
switch(display) {
  case "depressed":
    imgClasses += " depressed";
    break;
  case "protruding":
    imgClasses += " protruding";
    break;
  case "flat":
    imgClasses += " flat";
    break;
}

// Determine caption visibility:
let captionClass = "caption";
if (!caption) {
  captionClass += " hidden";
}
---

<div class="noonoo-image">
  <a href={linked && src}>
    <div class={imgClasses}>
      {!animated &&
        <img src={src} alt={alt} />
      }
      {animated &&
        <video autoplay loop muted src={src}></video>
      }
    </div>
  </a>
  <p class={captionClass}>{caption}</p>
</div>

<style>
  .noonoo-image {
    margin-bottom: 0.5rem;
    margin-top: 0.5rem;
  }

  .noonoo-image .container {
    overflow: hidden;
    position: relative;
    display: block;
  }

  .noonoo-image .container.round-corners {
    border-radius: 1.4rem;
  }

  .noonoo-image .container.straight-corners {
    border-radius: 0;
  }
  
  .noonoo-image .container::before {
    overflow: hidden;
    content: "";
    height: 100%;
    width: 100%;
    position: absolute;
  }

  .noonoo-image .container.depressed::before {
    box-shadow: var(--noonoo_depression_img);
  }

  .noonoo-image .container.protruding {
    box-shadow: var(--noonoo_protrusion_bright);
  }

  .noonoo-image .container img, .noonoo-image .container video {
    display: block;
    object-fit: cover;
    height: 100%;
    width: 100%;
  }

  .noonoo-image .caption {
    margin-left: 0.33rem;
    margin-right: 0.33rem;
    margin-top: 0.25rem;
  }
</style>