---
// [tag].astro /////////////////////////////////////////////////////////////////
// Dynamically creates routes @ /blog/tags/`tag` for every blog post tag.

import Layout from "../../../layouts/Layout.astro";
import BlogPostCard from "../../../components/BlogPostCard.astro";
import Pagination from "../../../components/Pagination.astro";

export async function getStaticPaths() {
  const blogPosts = await Astro.glob("../../../blog/*.mdx");
  const uniqueTags = [...new Set(blogPosts.map((blogPost) => blogPost.frontmatter.tags).flat())];
  return uniqueTags.map((tag) => {
    const tagSpecificPosts = blogPosts.filter((blogPost) => blogPost.frontmatter.tags.includes(tag));
    return {
      params: { tag },
      props: { blogPosts: tagSpecificPosts },
    };
  })
}
const { tag } = Astro.params;
const { blogPosts } = Astro.props;


const title = `Joel Elizaga | Blog | ${tag}`;
---

<Layout
  title={title}
  currentPage={"blog"}
>
  <main>
    <h1>
      <i class="fa-solid fa-atlas"></i> Blog
      <a href="/blog" class="current-tag">{tag}<i class="fa-solid fa-x"></i></a>
    </h1>
    <ul class="blog">
      {blogPosts.map(blogPost => (
        <BlogPostCard
          slug={`blog/${blogPost.frontmatter.slug}`}
          title={blogPost.frontmatter.title}
          description={blogPost.frontmatter.description}
          img={blogPost.frontmatter.img}
          pubDate={blogPost.frontmatter.pubDate}
          tags={blogPost.frontmatter.tags}
        />
      ))}
    </ul>
  </main>
</Layout>

<style>
  .blog {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  main {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .current-tag {
    align-items: center;
    border-radius: 2rem;
    box-shadow: var(--noonoo_protrusion_bright);
    color: var(--lawetlatla_ash_dim);
    display: inline-flex;
    gap: 1rem;
    float: right;
    font-size: 0.8em;
    font-weight: normal;
    justify-content: center;
    line-height: 0;
    padding-bottom: 0.8rem;
    padding-left: 1.4rem;
    padding-right: 1.4rem;
    padding-top: 0.8rem;
  }

  .current-tag:active {
    box-shadow: var(--noonoo_depression_bright), var(--noonoo_protrusion_bright);
  }

  .current-tag i {
    align-items: center;
    background-image: var(--noonoo_protrusion_rounded_bright);
    border: none;
    border-radius: 100%;
    box-shadow: var(--noonoo_protrusion_bright);
    color: var(--lawetlatla_ash_dim);
    display: flex;
    height: 1rem;
    font-size: 0.5em;
    padding: 0.4rem;
    justify-content: center;
    transition: box-shadow ease-in 0.1s, color ease-in 0.1s;
    width: 1rem;
  }

  .current-tag:hover i {
    color: var(--spectacular_red_bright);
  }
</style>